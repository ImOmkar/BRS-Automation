{% extends "base.html" %}

{% include "flash_message/message.html" %}

{% block navbar %}
<nav class="d-flex align-items-center justify-content-between">
    <img src="../static/image/Imperative_Logo.png" alt="Imperative logo" class="company-logo">
    <div class="menu-tab">
        <h5 class="fw-semibold">HDFC 4310</h5>
    </div>
    <div class="d-flex justify-content-between align-items-center user-div">
        <div class="d-flex me-3">
            <a href="" class="me-2"><img src="../static/image/user.svg" alt=""></a>
            <span class="fs-6">{{ current_user.username }}</span>
        </div>
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('logout') }}"><img src="../static/image/logout.svg" alt=""></a>
        {% else %}
            <a href="{{ url_for('login') }}">Login</a>
        {% endif %}
    </div>

</nav>
{% endblock navbar %}

{% block file_upload %}
<div class="custom-container">
    <div class="container">
        <form action="{{ url_for('get_data') }}" method="POST" enctype="multipart/form-data">
            <div class="d-flex justify-content-center align-items-center">
                <div class="col">
                    <div class="h5">Reconed File</div>
                    <div class="custom-form-control d-flex justify-content-center align-items-center" style="cursor: pointer;" onclick="document.getElementById('reconed-file').click()">
                        <input type="file" id="reconed-file" style="display: none;" accept=".csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" name="reconed-file">
                        <p class="m-0 text-truncate">Select file</p>
                    </div>
                    <span id="reconed-file-span" class="d-inline-block text-truncate" style="max-width: 100px;"></span>
                    <!-- <button type="submit" value="Submit" class="btn-purple-2 mt-2">Upload</button> -->
                    <!-- </form> -->
                </div>
            
                <div class="col">
                    <div class="h5">Bank File</div>
                    <div class="custom-form-control d-flex justify-content-center align-items-center" style="cursor: pointer;" onclick="document.getElementById('bank-file').click()">
                        <input type="file" id="bank-file" style="display: none;" accept=".csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" name="bank-file">
                        <p class="m-0 text-truncate">Select file</p>
                    </div>
                    <span id="bank-file-span" class="d-inline-block text-truncate" style="max-width: 100px;"></span>
                    <!-- <button type="submit" value="Submit" class="btn-purple-2 mt-2">Upload</button> -->
                    <!-- </form> -->
                </div>

                <div class="col">
                    <div class="h5">Merchant File</div>
                    <div class="custom-form-control d-flex justify-content-center align-items-center" style="cursor: pointer;" onclick="document.getElementById('merchant-file').click()">
                        <input type="file" id="merchant-file"
                            style="display: none;"
                            accept=".csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                            name="merchant-file">
                        <p class="m-0 text-truncate">Select file</p>
                    </div>
                    <span id="merchant-file-span" class="d-inline-block text-truncate" style="max-width: 100px;"></span>
                    <!-- <button type="submit" value="Submit" class="btn-purple-2 mt-2">Upload</button> -->
                    <!-- </form> -->
                </div>

                <div class="col">
                    <div class="h5">Ledger Report</div>
                    <!-- <form action=""> -->
                    <div class="custom-form-control d-flex justify-content-center align-items-center" style="cursor: pointer;" onclick="document.getElementById('ledger-report-file').click()">
                        <input type="file" id="ledger-report-file"
                            style="display: none;"
                            accept=".csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                            name="ledger-file">
                        <p class="m-0 text-truncate">Select file</p>
                    </div>
                    <span id="ledger-report-file-span" class="d-inline-block text-truncate" style="max-width: 100px;"></span>
                    <!-- <button type="submit" value="Submit" class="btn-purple-2 mt-2">Upload</button> -->
                </div>

                <div class="col">
                    <div class="h5">LMS Report</div>
                    <!-- <form action=""> -->
                    <div class="custom-form-control d-flex justify-content-center align-items-center" style="cursor: pointer;" onclick="document.getElementById('lms-report-file').click()">
                        <input type="file" id="lms-report-file"
                            style="display: none;"
                            accept=".csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                            name="pennant-file">
                        <p class="m-0 text-truncate">Select file</p>
                    </div>
                    <span id="lms-report-file-span" class="d-inline-block text-truncate" style="max-width: 100px;"></span>
                    <!-- <button type="submit" value="Submit" class="btn-purple-2 mt-2">Upload</button> -->
                </div>

                <div class="col mt-5 mb-4">
                    <div class="h5">Select Date</div>
                    <div class="form-group">
                        <div class="input-group">
                            <input type="date" class="form-control calender-selected-date file-label"
                                id="selected-date" name="recon_date"
                                onchange="updateProgressStep('Calendar Date')">
                        </div>
                    </div>
                    <br><br>
                </div>

                <div class="col mt-5 ms-5 mb-5">
                    <button id="openModalBtn" type="submit" class="btn-purple">Proceed</button>
                </div>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="fileInfoModal" tabindex="-1" aria-labelledby="fileInfoModalLabel"
                aria-hidden="true" data-bs-backdrop="static">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="d-flex align-items-center justify-content-around">
                                <h5>File name here</h5>
                                <h5>24/12/2000</h5>
                            </div>
                        </div>
                        <div class="p-2 justify-content-center d-flex">
                            <button id="downloadBtn" type="button" class="bg-purple-600 hover:bg-purple-800 font-semibold rounded-2xl px-5 py-3 text-white">Download <img
                                    src="./static/image/download.svg" alt="" class="ms-3"></button>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- Step progress -->
        <div class="container">
            <div class="step-progress mb-4">
                <div class="step" id="step1">
                    <div class="step-circle"><span class="step-icon">1</span></div>
                    <div class="step-line" style="left: calc(30px); width: 400px"></div>
                </div>
                <div class="step" id="step2">
                    <div class="step-circle"><span class="step-icon">2</span></div>
                    <div class="step-line" style="left: calc(30px); width: 400px"></div>
                </div>
                <div class="step" id="step3">
                    <div class="step-circle"><span class="step-icon">3</span></div>
                    <div class="step-line" style="left: calc(30px); width: 400px"></div>
                </div>
                <div class="step" id="step4">
                    <div class="step-circle"><span class="step-icon">4</span></div>
                    <div class="step-line" style="left: calc(30px); width: 400px"></div>
                </div>
                <div class="step" id="step5">
                    <div class="step-circle">5</div>
                    <div class="step-line" style="left: calc(90px); width: 440px"></div>
                </div>
                <div class="step" id="step6">
                    <div class="step-circle">6</div>
                    <div class="step-line" style="left: calc(40px); width: 310px"></div>
                </div>
                <div class="step" id="step7">
                    <div class="step-circle">7</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock file_upload %}

{% block processed_files %}
<main>
    <div class="custom-container">
        <div class="container">
            <!-- <h4>History</h4> -->
            <table id="datatable" class="display table table-responsive table-striped table-hover">
                <thead class="text-center">
                    <tr>
                        <th class="col-2">Sr. No.</th>
                        <th class="col-6">File Name</th>
                        <th class="col-2">Date</th>
                        <th class="col-2">Download</th>
                        <th class="col-2"></th>
                    </tr>
                    <tbody class="text-center">
                        {% for file in files %}
                        <tr>
                            <form method="post" action="{{ url_for('delete_processed_files', id=file.id) }}">
                                <td class="col-2">{{ loop.index }}</td>
                                <td class="col-6">{{ file.description }}</td>
                                <td class="col-2">{{ file.created_at|datetimeformat }}</td>
                                <td class="col-2">
                                    <a href="{{ url_for('download_file', filepath=file.url) }}">Download</a>
                                </td>
                                <td>
                                    <button class="btn btn-danger" type="submit">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" class="main-grid-item-icon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                                            <polyline points="3 6 5 6 21 6" />
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                            <line x1="10" x2="10" y1="11" y2="17" />
                                            <line x1="14" x2="14" y1="11" y2="17" />
                                        </svg>
                                    </button>
                                </td>
                            </form>
                        </tr>
                        {% endfor %}
                    </tbody>
                </thead>
            </table>
        </div>
    </div>
</main>
{% endblock processed_files %}